import{preloadImages}from"../../libs/utils.js";$=jQuery;let lenis=new Lenis;function customDropdown(){let e=document.querySelectorAll(".dropdown-custom");function r(n){e.forEach(e=>{var t=e.querySelector(".dropdown-custom-menu"),o=e.querySelector(".dropdown-custom-btn");n&&e===n||(t.classList.remove("dropdown--active"),o.classList.remove("--active"))})}e.forEach(t=>{let o=t.querySelector(".dropdown-custom-btn"),n=t.querySelector(".dropdown-custom-menu");var e=t.querySelectorAll(".dropdown-custom-item");let i=t.querySelector(".value-select");o.addEventListener("click",function(e){e.stopPropagation(),r(t),n.classList.toggle("dropdown--active"),o.classList.toggle("--active")}),document.addEventListener("click",function(){r()}),e.forEach(n=>{n.addEventListener("click",function(e){e.stopPropagation();var e=i.querySelector("img").src,t=i.querySelector("span").textContent,o=(i.innerHTML,n.innerHTML);i.innerHTML=o,n.innerHTML=`<img src="${e}" alt="" /><span>${t}</span>`,r()})}),window.addEventListener("scroll",function(){r()})})}function bookingForm(){var o;document.querySelector(".banner-booking")&&(o=new Lightpick({field:document.getElementById("check-in"),secondField:document.getElementById("check-out"),singleDate:!1,minDate:moment().startOf("now"),numberOfMonths:2,onOpen:function(){var e=o._opts.field.getBoundingClientRect(),t=o.el;e.top>=window.innerHeight/2?t.style.top=e.top+window.scrollY-t.offsetHeight+"px":t.style.top=e.bottom+window.scrollY+"px",t.style.left=e.left+window.scrollX+"px"}}),document.querySelectorAll(".people, .child").forEach(e=>{let n=e.querySelector(".min");var i=e.querySelector(".plus");let r=e.querySelector(".val"),a=e.querySelector("input[type='hidden']");if(n&&i&&r&&a){let t=e.classList.contains("people")?1:0,o=e=>{r.textContent=e,a.value=e,n.style.opacity=e>t?"1":"0.5"};i.onclick=()=>{var e=parseInt(r.textContent);e<10&&o(e+1)},n.onclick=()=>{var e=parseInt(r.textContent);e>t&&o(e-1)}}}))}function sectionAccommodation(){$("section.accommodation").length<1||$("section.accommodation").each(function(){var e=$(this),t=e.find(".accommodation-slider__main"),o=e.find(".swiper-pagination"),n=e.find(".swiper-button-prev"),e=e.find(".swiper-button-next"),i=t.hasClass("offer-slider"),r=$(window).width();let a;var l=767<$(window).width()?40:24,s=767<$(window).width()?80:0;a=i?r<768?1:2.5:r<768?1:r<992?2.5:3.3,new Swiper(t[0],{spaceBetween:l,slidesPerView:a,speed:1e3,slidesOffsetAfter:s,pagination:{el:o[0],type:"progressbar"},navigation:{prevEl:n[0],nextEl:e[0]}})})}function swiperFacility(){document.querySelectorAll(".swiper-facility").forEach(e=>{let o;new Swiper(e,{slidesPerView:1,watchSlidesProgress:!0,speed:1500,loop:!0,pagination:{el:e.querySelector(".swiper-pagination"),clickable:!0},navigation:{nextEl:e.querySelector(".swiper-button-next"),prevEl:e.querySelector(".swiper-button-prev")},on:{init(e){e.slides.forEach(e=>{e=e.querySelector(".caption");e&&(e.style.opacity="0",e.style.transition="opacity 0.6s ease")});let t=e.slides[e.activeIndex]?.querySelector(".caption");t&&(t.style.opacity="1",o=setTimeout(()=>{t.style.opacity="0"},2200))},slideChangeTransitionStart(e){e.slides.forEach(e=>{e=e.querySelector(".caption");e&&(e.style.opacity="0")}),clearTimeout(o)},slideChangeTransitionEnd(e){let t=e.slides[e.activeIndex]?.querySelector(".caption");t&&(t.style.opacity="1",o=setTimeout(()=>{t.style.opacity="0"},2200))},progress(o){o.slides.forEach(e=>{var t=(e.progress||0)*(.9*o.width),e=e.querySelector(".box-img");e&&!isNaN(t)&&(e.style.transform=`translate3d(${t}px, 0, 0)`)})},touchStart(e){e.slides.forEach(e=>{e.style.transition=""}),clearTimeout(o)},setTransition(e,t){let o="cubic-bezier(0.25, 0.1, 0.25, 1)";e.slides.forEach(e=>{e.style.transition=t+"ms "+o;e=e.querySelector(".box-img");e&&(e.style.transition=t+"ms "+o)})}}})})}function swiperAccommodation(){$(".swiper-accomodation").length<1||$(".accommodation-detail").each(function(){var n=$(this).find(".swiper-accomodation"),i=n.closest(".detail-gallery").find(".swiper-pagination"),r=n.closest(".detail-gallery").find(".swiper-button-prev"),a=n.closest(".detail-gallery").find(".swiper-button-next"),l=$(window).width()<992?1:2.5;let s=new Swiper(n[0],{slidesPerView:l,spaceBetween:24,slidesOffsetAfter:0,speed:1e3,parallax:!0,pagination:{el:i[0],type:"progressbar"},navigation:{prevEl:r[0],nextEl:a[0]}});l=n.find(".swiper-slide").first().data("bs-target");let c=$(l);if(c.length){let e=null,t=!1,o=(n.find(".swiper-slide").on("click",function(){$(this).index();c.modal("show")}),c.find(".swiper-accomodation-gallery"));i=c.find(".swiper-pagination"),r=c.find(".swiper-button-prev"),a=c.find(".swiper-button-next"),l=$(window).width()<992?1:"auto";e=new Swiper(o[0],{slidesPerView:l,slidesOffsetAfter:0,spaceBetween:24,speed:1e3,parallax:!0,pagination:{el:i[0],type:"progressbar"},navigation:{prevEl:r[0],nextEl:a[0]},breakpoints:{991:{spaceBetween:40,slidesPerView:"auto"}},on:{slideChange:function(){t||(t=!0,s.slideTo(e.activeIndex,0),t=!1)},init:function(){o.removeClass("swiper-hidden").addClass("swiper-visible")}}})}})}function ctaMess(){ScrollTrigger.create({start:"top top",end:99999,paused:!0,onUpdate:e=>{1===e.direction?$("#cta-mess").addClass("hide"):$("#cta-mess").removeClass("hide")}})}function distortionImg(){document.querySelectorAll(".distortion-img").forEach(e=>{var t,o=e.querySelector("img"),n=e.getAttribute("img-distortion")||"./assets/images/distortion/ripple.jpg";o&&(t=o.src,o.style.display="none",new hoverEffect({parent:e,intensity:.1,angle:0,image1:t,image2:t,displacementImage:n}))})}function loadingBanner(){let t=!1;$(".banner-hero-clip").length<1||gsap.timeline({scrollTrigger:{trigger:".banner-hero-clip",start:"top top",scrub:!0,pin:!0,once:!0,onUpdate:e=>{console.log(e.progress),1!==e.progress||t?.03<e.progress&&document.querySelector(".banner-title").classList.add("d-none"):(document.querySelector(".banner-hero-clip")?.classList.remove("banner-hero-clip"),document.querySelectorAll(".anim-clip-circle").forEach(e=>e.classList.remove("anim-clip-circle")),document.getElementById("header").classList.remove("hide-header"),t=!0,ScrollTrigger.refresh(),gsap.to(".button-find-room",{scrollTrigger:{trigger:"body",start:"top+=100vh top",end:"bottom top",toggleClass:{targets:".button-find-room",className:"hide"},toggleActions:"add remove none none"}}),lenis.scrollTo(0,{immediate:!0}))},onLeave:e=>{$("#cta-mess").length&&$("#cta-mess").removeClass("hide hide-by-loading"),$(".banner-booking").length&&$(".banner-booking").removeClass("hide");e.start;e.scroll(e.start),e.disable(),e.animation.progress(1),ScrollTrigger.refresh(),window.scrollTo({top:0,behavior:"smooth"})}}}).to(".anim-clip-circle",{clipPath:"circle(70.7% at 50% 50%)"}).to(".banner-container img",{scale:1},0)}function filterGalleryMobile(){var e=document.querySelector(".filter-mobile");if(e){let o=e.querySelector(".filter-value-select"),n=e.querySelector(".filter-head"),i=e.querySelector(".filter-body");e=i.querySelectorAll(".nav-link");o&&n&&i&&0!==e.length&&(o.addEventListener("click",()=>{n.classList.toggle("active"),i.classList.toggle("active")}),e.forEach(t=>{t.addEventListener("click",()=>{var e=t.querySelector(".title-tab");console.log(e),e&&(e=e.textContent.trim(),o.textContent=e,n.classList.remove("active"),i.classList.remove("active"))})}))}}function header(){var e=document.getElementById("hamburger");let t=document.getElementById("header-sub-menu"),o=document.querySelector("body");e.addEventListener("click",function(){this.classList.toggle("active"),t.classList.toggle("active"),o.classList.toggle("overflow-hidden")}),$(".button-find-room").on("click",function(e){e.preventDefault(),$(".banner-booking-mobile").addClass("active")}),$(".btn-back").on("click",function(e){$(".banner-booking-mobile").removeClass("active")})}function magicCursor(){var o;window.innerWidth<992||"undefined"==typeof MouseFollower||(o=new MouseFollower({speed:.8,scale:1,skewing:0,skewingText:0}),document.querySelectorAll("[data-cursor]").forEach(function(e){let t=e.getAttribute("data-cursor-text")?e.getAttribute("data-cursor-text"):"VIEW";e.addEventListener("mouseenter",()=>{o.setText(t)}),e.addEventListener("mouseleave",()=>{o.removeText()})}))}function distortionImgNav(){function t(e){e.querySelectorAll(".distortion-img-nav").forEach(t=>{var o=t.querySelector("img"),n=t.getAttribute("img-distortion")||"./assets/images/distortion/ripple.jpg";if(o){var i=o.src;o.style.display="none";let e=t.__hoverEffect;e&&"function"==typeof e.destroy&&e.destroy(),t.querySelectorAll("img, canvas").forEach(e=>e.remove()),t.appendChild(o),e=new hoverEffect({parent:t,intensity:.1,angle:0,image1:i,image2:i,displacementImage:n}),t.__hoverEffect=e}})}var e=document.querySelector(".tab-pane.active");e&&t(e),document.querySelectorAll('[data-bs-toggle="tab"]').forEach(e=>{e.addEventListener("shown.bs.tab",e=>{e=e.target.getAttribute("data-bs-target"),e=document.querySelector(e);e&&t(e)})})}function bookingOffer(){let i=$("form.booking-offer");if(i.length){let o=i.find("input[name='startday']")[0],n=i.find("input[name='endday']")[0];o&&n&&new Lightpick({field:o,secondField:n,singleDate:!1,numberOfMonths:1,format:"DD/MM/YYYY",minDate:moment(),onSelect:function(e,t){try{e&&t&&(o.value=e.format("DD/MM/YYYY"),n.value=t.format("DD/MM/YYYY"),[o,n].forEach(e=>e.classList.remove("error")))}catch(e){console.error("Lỗi trong Lightpick onSelect:",e)}}}),i.on("submit",function(e){e.preventDefault();e={startday:i.find("input[name='startday']"),endday:i.find("input[name='endday']"),adult:i.find("input[name='adult']"),child:i.find("input[name='child']"),name:i.find("input[name='name']"),phone:i.find("input[name='phone']"),email:i.find("input[name='email']"),offer_id:i.find("input[name='offer_id']")};i.find(".error-message").remove(),i.find("input").removeClass("error");let o=!0;$.each(e,(e,t)=>{"child"===e||t.val().trim()||(t.addClass("error"),o=!1)}),o&&$.ajax({type:"POST",url:ajaxUrl,data:{action:"submit_booking_form",startday:e.startday.val().trim(),endday:e.endday.val().trim(),adult:e.adult.val().trim(),child:e.child.val().trim()||"0",name:e.name.val().trim(),phone:e.phone.val().trim(),email:e.email.val().trim(),offer_id:e.offer_id.val().trim()},beforeSend:function(){i.find("button[type='submit']").addClass("aloading")},success:function(e){i.find("button[type='submit']").removeClass("aloading"),i[0].reset();let t=document.getElementById("modalSuccess"),o=bootstrap.Modal.getOrCreateInstance(t);t.classList.contains("show")||o.show(),setTimeout(function(){t.classList.contains("show")&&o.hide()},1e4)},error:function(e,t,o){console.error("Lỗi khi gửi form:",o)}})})}}function animationText(){gsap.registerPlugin(ScrollTrigger,SplitText),gsap.utils.toArray(".effect-line").forEach(e=>{var t=new SplitText(e,{type:"lines",linesClass:"line",mask:"lines"});gsap.fromTo(t.lines,{yPercent:100,willChange:"transform"},{yPercent:0,duration:1,ease:"power3.out",stagger:.05,scrollTrigger:{trigger:e,start:"top 60%"}})}),gsap.utils.toArray(".data-fade-in").forEach(e=>{gsap.fromTo(e,{"will-change":"opacity, transform",opacity:0,y:20},{scrollTrigger:{trigger:e,start:"top 70%",end:"bottom 70%"},opacity:1,y:0,duration:.5,ease:"sine.out"})}),window.innerWidth<992&&gsap.utils.toArray(".data-fade-in-mobile").forEach(e=>{gsap.fromTo(e,{"will-change":"opacity, transform",opacity:0,y:20},{scrollTrigger:{trigger:e,start:"top 70%",end:"bottom 70%"},opacity:1,y:0,duration:.5,ease:"sine.out"})})}function itemParallax(){$(".js-parallax").length<1||$(".image-parallax").length<1||(gsap.utils.toArray(".js-parallax").forEach(e=>{var t=parseFloat(e.getAttribute("data-y"))||100,o=e.getAttribute("data-direction")||"up";gsap.fromTo(e,{y:"down"===o?-t:t},{y:0,scrollTrigger:{trigger:e,start:"top bottom",end:"bottom top",scrub:1,ease:"power4",delay:.2}})}),document.querySelectorAll(".image-parallax").forEach(e=>{var t=e.querySelector("img, video");t&&(gsap.set(t,{yPercent:10}),gsap.to(t,{yPercent:-10,ease:"none",scrollTrigger:{trigger:e,start:"top 80%",end:"bottom top",scrub:!0}}))}))}function bookingFormMobile(){var o;991<window.innerWidth||document.querySelector(".banner-booking-mobile")&&(o=new Lightpick({field:document.getElementById("check-in-mobile"),secondField:document.getElementById("check-out-mobile"),singleDate:!1,minDate:moment().startOf("now"),numberOfMonths:2,onOpen:function(){var e=o._opts.field.getBoundingClientRect(),t=o.el;e.top>=window.innerHeight/2?t.style.top=e.top+window.scrollY-t.offsetHeight+"px":t.style.top=e.bottom+window.scrollY+"px",t.style.left=e.left+window.scrollX+"px"}}),document.querySelectorAll(".people, .child").forEach(e=>{let n=e.querySelector(".min");var i=e.querySelector(".plus");let r=e.querySelector(".val"),a=e.querySelector("input[type='hidden']");if(n&&i&&r&&a){let t=e.classList.contains("people")?1:0,o=e=>{r.textContent=e,a.value=e,n.style.opacity=e>t?"1":"0.5"};i.onclick=()=>{var e=parseInt(r.textContent);e<10&&o(e+1)},n.onclick=()=>{var e=parseInt(r.textContent);e>t&&o(e-1)}}}),document.querySelectorAll(".people, .child").forEach(e=>{let n=e.querySelector(".min");var i=e.querySelector(".plus");let r=e.querySelector(".val"),a=e.querySelector("input[type='hidden']");if(n&&i&&r&&a){let t=e.classList.contains("people")?1:0,o=e=>{r.textContent=e,a.value=e,n.style.opacity=e>t?"1":"0.5"};i.onclick=()=>{var e=parseInt(r.textContent);e<10&&o(e+1)},n.onclick=()=>{var e=parseInt(r.textContent);e>t&&o(e-1)}}}))}function loading(){var e;$(".loading").length<1||(gsap.set(".effect-line-banner",{opacity:0}),e=gsap.timeline({defaults:{duration:2,ease:"power2.inOut"}}),gsap.delayedCall(1,()=>{gsap.utils.toArray(".effect-line-banner").forEach(e=>{var t=new SplitText(e,{type:"lines",linesClass:"line",mask:"lines"});gsap.fromTo(t.lines,{yPercent:100,willChange:"transform",opacity:0},{yPercent:0,duration:1,ease:"power3.out",stagger:.05,opacity:1,onStart:()=>{gsap.set(e,{opacity:1})}})})}),e.fromTo(".loading",{clipPath:"inset(0% 0% 0% 0%)"},{clipPath:"inset(0% 0% 100% 0%)",onComplete:()=>{document.querySelector(".loading").classList.add("d-none")}}))}function handleStickyDetection(){let e=document.querySelector(".filter-desktop"),t=document.querySelector(".filter-mobile");if(e&&t){function o(){e&&(e.getBoundingClientRect().top<=86?e.classList.add("pinned"):e.classList.remove("pinned")),t&&(t.getBoundingClientRect().top<=48?t.classList.add("pinned"):t.classList.remove("pinned"))}window.addEventListener("scroll",o),o()}}function pageOffer(){var e,t;$(".navigation-tab").length<1||(e=new URLSearchParams(window.location.search).get("tab"))&&(t=$("#tab-"+e)).length&&setTimeout(function(){$("html, body").animate({scrollTop:t.offset().top-80},600)},1e3)}function animateDestinationItems(){var e,t;$(window).width()<992&&$(".destination .destination-item").length<1||(t=(e=document.querySelectorAll(".destination .destination-item")).length,t=Math.max(.1,2.4-.2*(t-1)),gsap.from(e,{scrollTrigger:{trigger:".destination-list",start:"top 60%",toggleActions:"play none none none"},opacity:0,y:50,duration:t,stagger:.2,ease:"power2.out"}))}function getNewletter(){$("#form-newletter").on("submit",function(e){e.preventDefault();let n=$(this);var t,e=n.find("input[type='email']");e.removeClass("error"),n.siblings("span").remove(),e.length?(t=e.val()?e.val().trim():"")?$.ajax({type:"POST",url:ajaxUrl,data:{action:"mercury_receive_newletter",email:t},beforeSend:function(){console.log("Đang gửi dữ liệu...")},success:function(e){n[0].reset();let t=document.getElementById("modalSuccessNewsletter"),o=bootstrap.Modal.getOrCreateInstance(t);t.classList.contains("show")||o.show(),setTimeout(function(){t.classList.contains("show")&&o.hide()},1e4)},error:function(e,t,o){console.error("Lỗi khi gửi form:",o),alert("Có lỗi xảy ra, vui lòng thử lại sau.")}}):e.addClass("error"):console.error("Không tìm thấy input email trong form.")})}function scrollToHashLink(){window.location.hash&&window.location.hash.startsWith("#room-")&&(window.scrollTo(0,0),setTimeout(function(){var e,t=$(window.location.hash);t.length&&(e=window.innerWidth<=768?40:48,t=t.offset().top-e,$("html, body").animate({scrollTop:t},600))},500))}lenis.on("scroll",ScrollTrigger.update),gsap.ticker.add(e=>{lenis.raf(1e3*e)}),gsap.ticker.lagSmoothing(0);let init=()=>{gsap.registerPlugin(ScrollTrigger),loading(),itemParallax(),customDropdown(),bookingForm(),sectionAccommodation(),swiperFacility(),ctaMess(),swiperAccommodation(),loadingBanner(),filterGalleryMobile(),header(),bookingOffer(),animationText(),bookingFormMobile(),pageOffer(),animateDestinationItems(),getNewletter(),scrollToHashLink()},isLinkClicked=(preloadImages("img").then(()=>{init()}),!1);$("a").on("click",function(e){!this.href||this.href.match(/^#/)||this.href.match(/^javascript:/)||(isLinkClicked=!0)}),$(window).on("beforeunload",function(){isLinkClicked||$(window).scrollTop(0),isLinkClicked=!1});